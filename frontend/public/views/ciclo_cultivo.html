<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gestión de Ciclos de Cultivo</title>
  <link rel="stylesheet" href="/frontend/public/css/components/tabla-unificada.css">
  <link rel="stylesheet" href="/frontend/public/css/pages/Normalize.css">
  <link rel="stylesheet" href="/frontend/public/css/pages/produccion.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
  
  <!-- CDNs para exportación -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <!-- Header consistente -->
  <div class="header">
    <div class="header__left-section">
      <span class="header__menu-item">Ciclos de Cultivo</span>
      <span class="header__menu-separator">/</span>
      <span class="header__menu-item">Gestión de Ciclos de Cultivo</span>
      <span class="header__menu-separator">-</span>
      <span class="header__menu-item" id="cantidadCiclos">Cantidad de Ciclos: 0</span>
    </div>
    <div class="header__right-section">
      <input type="text" class="header__search-bar" id="searchInput" placeholder="Buscar ciclos...">
      <span class="header__icon"><i class='bx bx-message-square-add' id="crearCicloBtn" title="Crear Ciclo"></i></span>
      <span class="header__icon"><box-icon name='bell' type='solid'></box-icon></span>
    </div>
  </div>

  <div class="sidebar"></div>
  <main class="full-main">
    <section class="content">
      <!-- Navegación de tabs -->
      <nav class="produccion__tabs">
        <button data-tab="listar" class="produccion__tab produccion__tab--active">Listar</button>
        <button data-tab="reportes" class="produccion__tab">Reportes</button>
        <button data-tab="graficos" class="produccion__tab">Gráficos</button>
      </nav>

      <main class="produccion__content">
        <!-- Sección Listar -->
        <section id="listar" class="produccion__section produccion__section--active">
          <div class="filters-container">
            <select id="estadoFilter" class="filter-select">
              <option value="">Todos los estados</option>
              <option value="habilitado">Habilitado</option>
              <option value="deshabilitado">Deshabilitado</option>
            </select>
            <select id="periodoFilter" class="filter-select">
              <option value="">Todos los períodos</option>
              <option value="activo">Período Activo</option>
              <option value="futuro">Período Futuro</option>
              <option value="pasado">Período Pasado</option>
            </select>
          </div>
          
          <table class="content__table">
            <thead class="content__table-head">
              <tr class="content__table-row">
                <th class="content__table-header">ID</th>
                <th class="content__table-header">Nombre</th>
                <th class="content__table-header">Período Inicio</th>
                <th class="content__table-header">Período Final</th>
                <th class="content__table-header">Duración</th>
                <th class="content__table-header">Usuario Responsable</th>
                <th class="content__table-header">Estado</th>
                <th class="content__table-header">Período</th>
                <th class="content__table-header">Acciones</th>
              </tr>
            </thead>
            <tbody class="content__table-body" id="ciclosTableBody"></tbody>
          </table>
        </section>

        <!-- Sección Reportes -->
        <section id="reportes" class="produccion__section">
          <h2>Generar Reportes de Ciclos</h2>
          <div class="reportes-container">
            <div class="reporte-filters">
              <h3>Filtros de Reporte</h3>
              <div class="filter-group">
                <label for="reporteEstado">Estado:</label>
                <select id="reporteEstado">
                  <option value="">Todos</option>
                  <option value="habilitado">Habilitado</option>
                  <option value="deshabilitado">Deshabilitado</option>
                </select>
              </div>
              <div class="filter-group">
                <label for="reportePeriodo">Período:</label>
                <select id="reportePeriodo">
                  <option value="">Todos</option>
                  <option value="activo">Activos</option>
                  <option value="futuro">Futuros</option>
                  <option value="pasado">Pasados</option>
                </select>
              </div>
              <div class="filter-group">
                <label for="reporteFechaInicio">Fecha desde:</label>
                <input type="date" id="reporteFechaInicio">
              </div>
              <div class="filter-group">
                <label for="reporteFechaFin">Fecha hasta:</label>
                <input type="date" id="reporteFechaFin">
              </div>
              <button id="generarReporteBtn" class="produccion__button produccion__button--primary">
                Generar Reporte
              </button>
              
              <div class="export-buttons">
                <button id="exportarReportePDFBtn" class="produccion__button produccion__button--secondary">
                  <i class="fas fa-file-pdf"></i> Exportar PDF
                </button>
                <button id="exportarReporteExcelBtn" class="produccion__button produccion__button--secondary">
                  <i class="fas fa-file-excel"></i> Exportar Excel
                </button>
              </div>
            </div>
            
            <div class="estadisticas-container" id="estadisticasContainer">
              <!-- Estadísticas se mostrarán aquí -->
            </div>
          </div>
        </section>

        <!-- Sección Gráficos -->
        <section id="graficos" class="produccion__section">
          <h2>Gráficos de Ciclos de Cultivo</h2>
          <div class="graficos-container">
            <div class="grafico-item">
              <h4>Distribución por Estado</h4>
              <canvas id="graficoEstados"></canvas>
            </div>
            <div class="grafico-item">
              <h4>Distribución por Período</h4>
              <canvas id="graficoPeriodos"></canvas>
            </div>
            <div class="grafico-item">
              <h4>Duración de Ciclos</h4>
              <canvas id="graficoDuraciones"></canvas>
            </div>
            <div class="grafico-item">
              <h4>Ciclos por Mes</h4>
              <canvas id="graficoTendencia"></canvas>
            </div>
          </div>
        </section>
      </main>
    </section>
  </main>

  <!-- Modal Crear/Editar Ciclo -->
  <div id="modalCiclo" class="modal">
    <div class="modal__content">
      <button class="modal__close">&times;</button>
      <h2 id="modalTitle">Crear Ciclo de Cultivo</h2>
      <form id="cicloForm" class="modal-form">
        <input type="hidden" id="cicloId">
        
        <div class="form-row">
          <div class="form-group">
            <label for="nombre">Nombre del Ciclo <span class="required">*</span></label>
            <input type="text" id="nombre" name="nombre" required maxlength="100" placeholder="Ej: Ciclo de Tomate Verano 2024">
          </div>
          <div class="form-group">
            <label for="usuario_id">Usuario Responsable</label>
            <select id="usuario_id" name="usuario_id">
              <option value="">Sin asignar</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label for="descripcion">Descripción <span class="required">*</span></label>
          <textarea id="descripcion" name="descripcion" required rows="3" placeholder="Describe las características y objetivos del ciclo de cultivo"></textarea>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="periodo_inicio">Fecha de Inicio <span class="required">*</span></label>
            <input type="date" id="periodo_inicio" name="periodo_inicio" required>
          </div>
          <div class="form-group">
            <label for="periodo_final">Fecha Final <span class="required">*</span></label>
            <input type="date" id="periodo_final" name="periodo_final" required>
          </div>
        </div>

        <div class="form-group">
          <label>Duración Estimada</label>
          <span id="duracionEstimada" class="form-value">-- días</span>
        </div>

        <div class="form-group">
          <label for="novedades">Novedades y Observaciones</label>
          <textarea id="novedades" name="novedades" rows="3" placeholder="Información adicional, cambios o novedades importantes"></textarea>
        </div>

        <div class="form-group" id="estadoGroup" style="display: none;">
          <label for="estado">Estado</label>
          <select id="estado" name="estado">
            <option value="habilitado">Habilitado</option>
            <option value="deshabilitado">Deshabilitado</option>
          </select>
        </div>

        <div class="modal__actions">
          <button type="button" class="produccion__button produccion__button--secondary" id="cancelarBtn">
            Cancelar
          </button>
          <button type="submit" class="produccion__button produccion__button--primary">
            <span id="submitText">Crear Ciclo</span>
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal Ver Detalles -->
  <div id="modalDetalles" class="modal">
    <div class="modal__content">
      <button class="modal__close">&times;</button>
      <h2>Detalles del Ciclo de Cultivo</h2>
      <div id="detallesContent" class="detalles-content">
        <!-- Contenido dinámico -->
      </div>
      <div class="modal__actions">
        <button type="button" class="produccion__button produccion__button--secondary modal__close">
          Cerrar
        </button>
      </div>
    </div>
  </div>

  <script src="/frontend/JS/sidebar.js"></script>
  
  <script>
    // Configuración API
    const API_URL = "http://localhost:3000/api/ciclo-cultivo";
    const USUARIOS_API_URL = "http://localhost:3000/api/usuarios";

    // Variables globales
    let todosLosCiclos = [];
    let ciclosFiltrados = [];
    let usuarios = [];
    let datosReporte = [];

    // Elementos DOM
    const tableBody = document.getElementById('ciclosTableBody');
    const searchInput = document.getElementById('searchInput');
    const estadoFilter = document.getElementById('estadoFilter');
    const periodoFilter = document.getElementById('periodoFilter');
    const modalCiclo = document.getElementById('modalCiclo');
    const modalDetalles = document.getElementById('modalDetalles');
    const cicloForm = document.getElementById('cicloForm');
    const cantidadCiclos = document.getElementById('cantidadCiclos');

    // Funciones de utilidad
    function showNotification(message, type = 'info') {
      alert(message);
    }

    function formatDate(dateString) {
      if (!dateString) return 'N/A';
      return new Date(dateString).toLocaleDateString('es-CO');
    }

    function calcularDuracion(inicio, final) {
      if (!inicio || !final) return 0;
      const fechaInicio = new Date(inicio);
      const fechaFinal = new Date(final);
      const diffTime = Math.abs(fechaFinal - fechaInicio);
      return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    }

    function obtenerEstadoPeriodo(inicio, final) {
      const hoy = new Date();
      const fechaInicio = new Date(inicio);
      const fechaFinal = new Date(final);
      
      if (hoy < fechaInicio) return 'futuro';
      if (hoy > fechaFinal) return 'pasado';
      return 'activo';
    }

    function obtenerClaseEstadoPeriodo(estado) {
      switch(estado) {
        case 'activo': return 'periodo-activo';
        case 'futuro': return 'periodo-futuro';
        case 'pasado': return 'periodo-pasado';
        default: return '';
      }
    }

    function obtenerTextoEstadoPeriodo(estado) {
      switch(estado) {
        case 'activo': return 'Activo';
        case 'futuro': return 'Futuro';
        case 'pasado': return 'Finalizado';
        default: return 'N/A';
      }
    }

    // Cargar usuarios
    async function cargarUsuarios() {
      try {
        const response = await fetch(USUARIOS_API_URL);
        if (response.ok) {
          usuarios = await response.json();
          llenarSelectorUsuarios();
        }
      } catch (error) {
        console.error('Error cargando usuarios:', error);
      }
    }

    function llenarSelectorUsuarios() {
      const usuarioSelect = document.getElementById('usuario_id');
      if (usuarioSelect) {
        usuarioSelect.innerHTML = '<option value="">Sin asignar</option>';
        usuarios.filter(u => u.estado === 'habilitado').forEach(user => {
          usuarioSelect.innerHTML += `<option value="${user.id}">${user.nombre}</option>`;
        });
      }
    }

    // Cargar ciclos
    async function cargarCiclos() {
      try {
        const response = await fetch(API_URL);
        if (!response.ok) throw new Error('Error al cargar ciclos');
        
        todosLosCiclos = await response.json();
        ciclosFiltrados = todosLosCiclos;
        renderizarTabla();
      } catch (error) {
        console.error('Error:', error);
        showNotification('Error al cargar los ciclos de cultivo', 'error');
      }
    }

    // Renderizar tabla
    function renderizarTabla() {
      if (!tableBody) return;
      
      if (!ciclosFiltrados.length) {
        tableBody.innerHTML = '<tr><td colspan="9" style="text-align: center;">No hay ciclos registrados</td></tr>';
        if (cantidadCiclos) cantidadCiclos.textContent = 'Cantidad de Ciclos: 0';
        return;
      }

      tableBody.innerHTML = ciclosFiltrados.map(ciclo => {
        const duracion = calcularDuracion(ciclo.periodo_inicio, ciclo.periodo_final);
        const estadoPeriodo = obtenerEstadoPeriodo(ciclo.periodo_inicio, ciclo.periodo_final);
        
        return `
          <tr class="content__table-row">
            <td class="content__table-data">${ciclo.id}</td>
            <td class="content__table-data">${ciclo.nombre}</td>
            <td class="content__table-data">${formatDate(ciclo.periodo_inicio)}</td>
            <td class="content__table-data">${formatDate(ciclo.periodo_final)}</td>
            <td class="content__table-data">${duracion} días</td>
            <td class="content__table-data">${ciclo.usuario_nombre || 'N/A'}</td>
            <td class="content__table-data">
              <span class="${ciclo.estado === 'habilitado' ? 'content__status-enabled' : 'content__status-disabled'}"></span>
              ${ciclo.estado === 'habilitado' ? 'Activo' : 'Inactivo'}
            </td>
            <td class="content__table-data">
              <span class="periodo-badge ${obtenerClaseEstadoPeriodo(estadoPeriodo)}">
                ${obtenerTextoEstadoPeriodo(estadoPeriodo)}
              </span>
            </td>
            <td class="content__table-data">
              <div class="content__icon-container">
                <div class="content__icon content__icon--blue" title="Ver detalles">
                  <i class="bx bx-show view-button" data-id="${ciclo.id}"></i>
                </div>
                <div class="content__icon content__icon--blue" title="Editar">
                  <i class="bx bxs-edit edit-button" data-id="${ciclo.id}"></i>
                </div>
                <div class="content__icon content__icon--red" title="Eliminar">
                  <i class="bx bxs-trash delete-button" data-id="${ciclo.id}"></i>
                </div>
              </div>
            </td>
          </tr>
        `;
      }).join('');

      if (cantidadCiclos) {
        cantidadCiclos.textContent = `Cantidad de Ciclos: ${ciclosFiltrados.length}`;
      }
    }

    // Filtros
    function aplicarFiltros() {
      if (!searchInput) return;
      
      const searchTerm = searchInput.value.toLowerCase();
      const estadoFiltro = estadoFilter ? estadoFilter.value : '';
      const periodoFiltro = periodoFilter ? periodoFilter.value : '';

      ciclosFiltrados = todosLosCiclos.filter(ciclo => {
        const matchesSearch = !searchTerm || 
          ciclo.nombre.toLowerCase().includes(searchTerm) ||
          (ciclo.descripcion && ciclo.descripcion.toLowerCase().includes(searchTerm));
        
        const matchesEstado = !estadoFiltro || ciclo.estado === estadoFiltro;
        
        let matchesPeriodo = true;
        if (periodoFiltro) {
          const estadoPeriodo = obtenerEstadoPeriodo(ciclo.periodo_inicio, ciclo.periodo_final);
          matchesPeriodo = estadoPeriodo === periodoFiltro;
        }

        return matchesSearch && matchesEstado && matchesPeriodo;
      });

      renderizarTabla();
    }

    // Gestión de tabs
    function setupTabs() {
      const tabs = document.querySelectorAll('.produccion__tab');
      const sections = document.querySelectorAll('.produccion__section');

      tabs.forEach(tab => {
        tab.addEventListener('click', () => {
          const targetTab = tab.dataset.tab;

          tabs.forEach(t => t.classList.remove('produccion__tab--active'));
          sections.forEach(s => s.classList.remove('produccion__section--active'));

          tab.classList.add('produccion__tab--active');
          const targetSection = document.getElementById(targetTab);
          if (targetSection) {
            targetSection.classList.add('produccion__section--active');
          }

          if (targetTab === 'graficos') {
            setTimeout(generarGraficos, 100);
          }
        });
      });
    }

    // Modal functions
    function abrirModal(modal) {
      if (modal) {
        modal.style.display = 'flex';
      }
    }

    function cerrarModal(modal) {
      if (modal) {
        modal.style.display = 'none';
      }
    }

    // Calcular duración en tiempo real
    function calcularDuracionEnTiempoReal() {
      const inicioInput = document.getElementById('periodo_inicio');
      const finalInput = document.getElementById('periodo_final');
      const duracionSpan = document.getElementById('duracionEstimada');
      
      if (inicioInput && finalInput && duracionSpan) {
        const inicio = inicioInput.value;
        const final = finalInput.value;
        
        if (inicio && final) {
          const duracion = calcularDuracion(inicio, final);
          duracionSpan.textContent = `${duracion} días`;
        } else {
          duracionSpan.textContent = '-- días';
        }
      }
    }

    // Crear ciclo
    function crearCiclo() {
      const modalTitle = document.getElementById('modalTitle');
      const submitText = document.getElementById('submitText');
      const cicloIdInput = document.getElementById('cicloId');
      const estadoGroup = document.getElementById('estadoGroup');
      
      if (modalTitle) modalTitle.textContent = 'Crear Ciclo de Cultivo';
      if (submitText) submitText.textContent = 'Crear Ciclo';
      if (cicloIdInput) cicloIdInput.value = '';
      if (estadoGroup) estadoGroup.style.display = 'none';
      
      if (cicloForm) cicloForm.reset();
      
      const duracionSpan = document.getElementById('duracionEstimada');
      if (duracionSpan) duracionSpan.textContent = '-- días';
      
      abrirModal(modalCiclo);
    }

    // Editar ciclo
    async function editarCiclo(id) {
      console.log('Editando ciclo:', id);
      
      try {
        const response = await fetch(`${API_URL}/${id}`);
        if (!response.ok) throw new Error('Error al cargar ciclo');
        
        const ciclo = await response.json();
        console.log('Datos del ciclo:', ciclo);
        
        const modalTitle = document.getElementById('modalTitle');
        const submitText = document.getElementById('submitText');
        const cicloIdInput = document.getElementById('cicloId');
        const estadoGroup = document.getElementById('estadoGroup');
        
        if (modalTitle) modalTitle.textContent = 'Editar Ciclo de Cultivo';
        if (submitText) submitText.textContent = 'Actualizar Ciclo';
        if (cicloIdInput) cicloIdInput.value = ciclo.id;
        if (estadoGroup) estadoGroup.style.display = 'block';
        
        // Llenar formulario
        const campos = ['nombre', 'descripcion', 'novedades'];
        campos.forEach(campo => {
          const element = document.getElementById(campo);
          if (element) element.value = ciclo[campo] || '';
        });
        
        // Usuario
        const usuarioSelect = document.getElementById('usuario_id');
        if (usuarioSelect) usuarioSelect.value = ciclo.usuario_id || '';
        
        // Estado
        const estadoSelect = document.getElementById('estado');
        if (estadoSelect) estadoSelect.value = ciclo.estado || 'habilitado';
        
        // Fechas
        const fechaInicio = document.getElementById('periodo_inicio');
        const fechaFinal = document.getElementById('periodo_final');
        if (fechaInicio && ciclo.periodo_inicio) {
          fechaInicio.value = ciclo.periodo_inicio.split('T')[0];
        }
        if (fechaFinal && ciclo.periodo_final) {
          fechaFinal.value = ciclo.periodo_final.split('T')[0];
        }
        
        // Calcular duración
        calcularDuracionEnTiempoReal();

        abrirModal(modalCiclo);
      } catch (error) {
        console.error('Error:', error);
        showNotification('Error al cargar los datos del ciclo', 'error');
      }
    }

    // Ver detalles
    async function verDetalles(id) {
      console.log('Viendo detalles del ciclo:', id);
      
      try {
        const response = await fetch(`${API_URL}/${id}`);
        if (!response.ok) throw new Error('Error al cargar detalles');
        
        const ciclo = await response.json();
        console.log('Detalles del ciclo:', ciclo);
        
        const duracion = calcularDuracion(ciclo.periodo_inicio, ciclo.periodo_final);
        const estadoPeriodo = obtenerEstadoPeriodo(ciclo.periodo_inicio, ciclo.periodo_final);

        const detallesContent = document.getElementById('detallesContent');
        if (detallesContent) {
          detallesContent.innerHTML = `
            <div class="detalle-grid">
              <div class="detalle-item"><strong>ID:</strong> ${ciclo.id}</div>
              <div class="detalle-item"><strong>Nombre:</strong> ${ciclo.nombre}</div>
              <div class="detalle-item"><strong>Estado:</strong> 
                <span class="${ciclo.estado === 'habilitado' ? 'content__status-enabled' : 'content__status-disabled'}">
                  ${ciclo.estado === 'habilitado' ? 'Activo' : 'Inactivo'}
                </span>
              </div>
              <div class="detalle-item"><strong>Usuario Responsable:</strong> ${ciclo.usuario_nombre || 'Sin asignar'}</div>
              <div class="detalle-item"><strong>Fecha de Inicio:</strong> ${formatDate(ciclo.periodo_inicio)}</div>
              <div class="detalle-item"><strong>Fecha Final:</strong> ${formatDate(ciclo.periodo_final)}</div>
              <div class="detalle-item"><strong>Duración:</strong> ${duracion} días</div>
              <div class="detalle-item"><strong>Estado del Período:</strong>
                <span class="periodo-badge ${obtenerClaseEstadoPeriodo(estadoPeriodo)}">
                  ${obtenerTextoEstadoPeriodo(estadoPeriodo)}
                </span>
              </div>
              <div class="detalle-item full-width"><strong>Descripción:</strong><br>${ciclo.descripcion || 'Sin descripción'}</div>
              <div class="detalle-item full-width"><strong>Novedades:</strong><br>${ciclo.novedades || 'Sin novedades registradas'}</div>
              <div class="detalle-item full-width"><strong>Fecha de Creación:</strong> ${formatDate(ciclo.fecha_creacion)}</div>
            </div>
          `;
        }
        
        abrirModal(modalDetalles);
      } catch (error) {
        console.error('Error:', error);
        showNotification('Error al cargar los detalles', 'error');
      }
    }

    // Eliminar ciclo
    async function eliminarCiclo(id) {
      if (!confirm('¿Está seguro de que desea eliminar este ciclo de cultivo? Esta acción no se puede deshacer.')) {
        return;
      }

      try {
        const response = await fetch(`${API_URL}/${id}`, {
          method: 'DELETE'
        });

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.error || 'Error al eliminar');
        }

        showNotification('Ciclo eliminado exitosamente', 'success');
        cargarCiclos();
      } catch (error) {
        console.error('Error:', error);
        showNotification('Error: ' + error.message, 'error');
      }
    }

    // Generar estadísticas
    function generarEstadisticas(datos = ciclosFiltrados) {
      const stats = {
        total: datos.length,
        habilitados: datos.filter(c => c.estado === 'habilitado').length,
        deshabilitados: datos.filter(c => c.estado === 'deshabilitado').length,
        activos: 0,
        futuros: 0,
        pasados: 0,
        duracionPromedio: 0,
        usuariosCount: {}
      };

      let duracionTotal = 0;
      datos.forEach(ciclo => {
        const estadoPeriodo = obtenerEstadoPeriodo(ciclo.periodo_inicio, ciclo.periodo_final);
        stats[estadoPeriodo + 's']++;
        
        const duracion = calcularDuracion(ciclo.periodo_inicio, ciclo.periodo_final);
        duracionTotal += duracion;
        
        if (ciclo.usuario_nombre) {
          stats.usuariosCount[ciclo.usuario_nombre] = (stats.usuariosCount[ciclo.usuario_nombre] || 0) + 1;
        }
      });

      stats.duracionPromedio = datos.length > 0 ? Math.round(duracionTotal / datos.length) : 0;

      return stats;
    }

    // Mostrar estadísticas
    function mostrarEstadisticas(datos = datosReporte.length ? datosReporte : ciclosFiltrados) {
      const container = document.getElementById('estadisticasContainer');
      if (!container) return;
      
      const stats = generarEstadisticas(datos);
      
      let usuariosHtml = '';
      Object.entries(stats.usuariosCount).forEach(([usuario, count]) => {
        usuariosHtml += `<div class="stat-item"><strong>${usuario}:</strong> ${count}</div>`;
      });

      container.innerHTML = `
        <h3>Estadísticas ${datos.length !== ciclosFiltrados.length ? '(Filtradas)' : ''}</h3>
        <div class="stats-grid">
          <div class="stat-item"><strong>Total Ciclos:</strong> ${stats.total}</div>
          <div class="stat-item"><strong>Habilitados:</strong> ${stats.habilitados}</div>
          <div class="stat-item"><strong>Deshabilitados:</strong> ${stats.deshabilitados}</div>
          <div class="stat-item"><strong>Ciclos Activos:</strong> ${stats.activos}</div>
          <div class="stat-item"><strong>Ciclos Futuros:</strong> ${stats.futuros}</div>
          <div class="stat-item"><strong>Ciclos Finalizados:</strong> ${stats.pasados}</div>
          <div class="stat-item"><strong>Duración Promedio:</strong> ${stats.duracionPromedio} días</div>
        </div>
        <h4>Por Usuarios Responsables</h4>
        <div class="stats-grid">${usuariosHtml || '<div class="stat-item">Sin datos disponibles</div>'}</div>
      `;
    }

    // Generar gráficos
    function generarGraficos() {
      console.log('Generando gráficos...');
      
      const charts = ['graficoEstados', 'graficoPeriodos', 'graficoDuraciones', 'graficoTendencia'];
      charts.forEach(chartId => {
        const existingChart = Chart.getChart(chartId);
        if (existingChart) {
          existingChart.destroy();
        }
      });

      const stats = generarEstadisticas(todosLosCiclos);

      // 1. Gráfico de estados
      const ctxEstados = document.getElementById('graficoEstados');
      if (ctxEstados) {
        new Chart(ctxEstados, {
          type: 'doughnut',
          data: {
            labels: ['Habilitados', 'Deshabilitados'],
            datasets: [{
              data: [stats.habilitados, stats.deshabilitados],
              backgroundColor: ['#28a745', '#dc3545'],
              borderWidth: 2
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { position: 'bottom' },
              title: { display: true, text: 'Estado de Ciclos' }
            }
          }
        });
      }

      // 2. Gráfico de períodos
      const ctxPeriodos = document.getElementById('graficoPeriodos');
      if (ctxPeriodos) {
        new Chart(ctxPeriodos, {
          type: 'pie',
          data: {
            labels: ['Activos', 'Futuros', 'Finalizados'],
            datasets: [{
              data: [stats.activos, stats.futuros, stats.pasados],
              backgroundColor: ['#28a745', '#ffc107', '#6c757d']
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { position: 'bottom' },
              title: { display: true, text: 'Distribución por Período' }
            }
          }
        });
      }

      // 3. Gráfico de duraciones
      const ctxDuraciones = document.getElementById('graficoDuraciones');
      if (ctxDuraciones) {
        const duraciones = todosLosCiclos.map(ciclo => ({
          nombre: ciclo.nombre.length > 15 ? ciclo.nombre.substring(0, 15) + '...' : ciclo.nombre,
          duracion: calcularDuracion(ciclo.periodo_inicio, ciclo.periodo_final)
        })).slice(0, 10);
        
        new Chart(ctxDuraciones, {
          type: 'bar',
          data: {
            labels: duraciones.map(d => d.nombre),
            datasets: [{
              label: 'Duración (días)',
              data: duraciones.map(d => d.duracion),
              backgroundColor: '#17a2b8',
              borderColor: '#17a2b8',
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: { y: { beginAtZero: true } },
            plugins: {
              legend: { position: 'top' },
              title: { display: true, text: 'Duración de Ciclos (Top 10)' }
            }
          }
        });
      }

      // 4. Gráfico de tendencia
      const ctxTendencia = document.getElementById('graficoTendencia');
      if (ctxTendencia) {
        const meses = {};
        
        todosLosCiclos.forEach(ciclo => {
          if (ciclo.fecha_creacion) {
            const fecha = new Date(ciclo.fecha_creacion);
            const mes = fecha.toLocaleDateString('es-CO', { year: 'numeric', month: 'short' });
            meses[mes] = (meses[mes] || 0) + 1;
          }
        });

        const mesesOrdenados = Object.keys(meses).sort((a, b) => new Date(a) - new Date(b));

        new Chart(ctxTendencia, {
          type: 'line',
          data: {
            labels: mesesOrdenados,
            datasets: [{
              label: 'Ciclos Creados',
              data: mesesOrdenados.map(mes => meses[mes]),
              borderColor: '#28a745',
              backgroundColor: 'rgba(40, 167, 69, 0.1)',
              tension: 0.4,
              fill: true
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: { y: { beginAtZero: true } },
            plugins: {
              legend: { position: 'top' },
              title: { display: true, text: 'Tendencia de Creación de Ciclos' }
            }
          }
        });
      }

      console.log('Gráficos generados exitosamente');
    }

    // Exportar PDF
    function exportarReportePDF() {
      const datos = datosReporte.length ? datosReporte : ciclosFiltrados;
      
      try {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();

        doc.setFontSize(18);
        doc.setTextColor(40, 40, 40);
        doc.text('Reporte de Ciclos de Cultivo', 14, 22);
        
        doc.setFontSize(11);
        doc.setTextColor(100, 100, 100);
        doc.text(`Generado el: ${new Date().toLocaleDateString('es-CO')} ${new Date().toLocaleTimeString('es-CO')}`, 14, 30);

        const stats = generarEstadisticas(datos);
        let y = 45;
        
        doc.setFontSize(14);
        doc.setTextColor(40, 40, 40);
        doc.text('Resumen Estadístico:', 14, y);
        y += 10;
        
        doc.setFontSize(10);
        doc.text(`• Total de ciclos: ${stats.total}`, 20, y); y += 6;
        doc.text(`• Ciclos habilitados: ${stats.habilitados}`, 20, y); y += 6;
        doc.text(`• Ciclos deshabilitados: ${stats.deshabilitados}`, 20, y); y += 6;
        doc.text(`• Ciclos activos: ${stats.activos}`, 20, y); y += 6;
        doc.text(`• Ciclos futuros: ${stats.futuros}`, 20, y); y += 6;
        doc.text(`• Ciclos finalizados: ${stats.pasados}`, 20, y); y += 6;
        doc.text(`• Duración promedio: ${stats.duracionPromedio} días`, 20, y); y += 15;

        const tableData = datos.map(ciclo => {
          const duracion = calcularDuracion(ciclo.periodo_inicio, ciclo.periodo_final);
          const estadoPeriodo = obtenerTextoEstadoPeriodo(obtenerEstadoPeriodo(ciclo.periodo_inicio, ciclo.periodo_final));
          
          return [
            ciclo.id,
            ciclo.nombre.length > 25 ? ciclo.nombre.substring(0, 25) + '...' : ciclo.nombre,
            formatDate(ciclo.periodo_inicio),
            formatDate(ciclo.periodo_final),
            `${duracion} días`,
            ciclo.usuario_nombre || 'N/A',
            ciclo.estado === 'habilitado' ? 'Activo' : 'Inactivo',
            estadoPeriodo
          ];
        });

        doc.autoTable({
          head: [['ID', 'Nombre', 'F. Inicio', 'F. Final', 'Duración', 'Usuario', 'Estado', 'Período']],
          body: tableData,
          startY: y,
          styles: { 
            fontSize: 8,
            cellPadding: 3
          },
          headStyles: { 
            fillColor: [40, 167, 69],
            textColor: 255,
            fontStyle: 'bold'
          },
          alternateRowStyles: { fillColor: [245, 245, 245] },
          columnStyles: {
            0: { cellWidth: 15 }
          }
        });

        doc.save(`ciclos_cultivo_reporte_${new Date().toISOString().split('T')[0]}.pdf`);
        showNotification('Reporte PDF exportado exitosamente', 'success');
      } catch (error) {
        console.error('Error al exportar PDF:', error);
        showNotification('Error al exportar PDF. Verifica que las librerías estén cargadas.', 'error');
      }
    }

    // Exportar Excel
    function exportarReporteExcel() {
      const datos = datosReporte.length ? datosReporte : ciclosFiltrados;
      
      try {
        const stats = generarEstadisticas(datos);
        
        const statsData = [
          ['Reporte de Ciclos de Cultivo'],
          ['Generado el:', new Date().toLocaleDateString('es-CO') + ' ' + new Date().toLocaleTimeString('es-CO')],
          [''],
          ['RESUMEN ESTADÍSTICO'],
          ['Total de ciclos', stats.total],
          ['Ciclos habilitados', stats.habilitados],
          ['Ciclos deshabilitados', stats.deshabilitados],
          ['Ciclos activos', stats.activos],
          ['Ciclos futuros', stats.futuros],
          ['Ciclos finalizados', stats.pasados],
          ['Duración promedio (días)', stats.duracionPromedio],
          [''],
          ['DISTRIBUCIÓN POR USUARIOS'],
          ...Object.entries(stats.usuariosCount).map(([usuario, cantidad]) => [usuario, cantidad])
        ];

        const ciclosData = [
          ['ID', 'Nombre', 'Descripción', 'Fecha Inicio', 'Fecha Final', 'Duración (días)', 'Usuario Responsable', 'Estado', 'Estado Período', 'Novedades', 'Fecha Creación'],
          ...datos.map(ciclo => {
            const duracion = calcularDuracion(ciclo.periodo_inicio, ciclo.periodo_final);
            const estadoPeriodo = obtenerTextoEstadoPeriodo(obtenerEstadoPeriodo(ciclo.periodo_inicio, ciclo.periodo_final));
            
            return [
              ciclo.id,
              ciclo.nombre,
              ciclo.descripcion || '',
              formatDate(ciclo.periodo_inicio),
              formatDate(ciclo.periodo_final),
              duracion,
              ciclo.usuario_nombre || 'Sin asignar',
              ciclo.estado === 'habilitado' ? 'Activo' : 'Inactivo',
              estadoPeriodo,
              ciclo.novedades || '',
              formatDate(ciclo.fecha_creacion)
            ];
          })
        ];

        const wb = XLSX.utils.book_new();
        const wsStats = XLSX.utils.aoa_to_sheet(statsData);
        const wsCiclos = XLSX.utils.aoa_to_sheet(ciclosData);
        
        wsStats['!cols'] = [{ width: 30 }, { width: 20 }];
        wsCiclos['!cols'] = [
          { width: 8 }, { width: 25 }, { width: 30 }, { width: 12 }, 
          { width: 12 }, { width: 15 }, { width: 20 }, { width: 10 },
          { width: 15 }, { width: 25 }, { width: 15 }
        ];
        
        XLSX.utils.book_append_sheet(wb, wsStats, "Estadísticas");
        XLSX.utils.book_append_sheet(wb, wsCiclos, "Ciclos de Cultivo");

        XLSX.writeFile(wb, `ciclos_cultivo_reporte_${new Date().toISOString().split('T')[0]}.xlsx`);
        showNotification('Reporte Excel exportado exitosamente', 'success');
      } catch (error) {
        console.error('Error al exportar Excel:', error);
        showNotification('Error al exportar Excel. Verifica que las librerías estén cargadas.', 'error');
      }
    }

    // Event listeners
    function setupEventListeners() {
      console.log('Setting up event listeners...');
      
      // Filtros
      if (searchInput) {
        searchInput.addEventListener('input', aplicarFiltros);
      }
      if (estadoFilter) {
        estadoFilter.addEventListener('change', aplicarFiltros);
      }
      if (periodoFilter) {
        periodoFilter.addEventListener('change', aplicarFiltros);
      }

      // Botón crear ciclo
      const crearBtn = document.getElementById('crearCicloBtn');
      if (crearBtn) {
        crearBtn.addEventListener('click', (e) => {
          e.preventDefault();
          crearCiclo();
        });
      }

      // Event listeners para acciones en tabla
      if (tableBody) {
        tableBody.addEventListener('click', async (e) => {
          const id = e.target.dataset.id;
          
          if (e.target.classList.contains('view-button')) {
            verDetalles(id);
          } else if (e.target.classList.contains('edit-button')) {
            editarCiclo(id);
          } else if (e.target.classList.contains('delete-button')) {
            eliminarCiclo(id);
          }
        });
      }

      // Reportes
      const generarReporteBtn = document.getElementById('generarReporteBtn');
      if (generarReporteBtn) {
        generarReporteBtn.addEventListener('click', () => {
          const estadoFiltro = document.getElementById('reporteEstado').value;
          const periodoFiltro = document.getElementById('reportePeriodo').value;
          const fechaInicio = document.getElementById('reporteFechaInicio').value;
          const fechaFin = document.getElementById('reporteFechaFin').value;

          datosReporte = todosLosCiclos.filter(ciclo => {
            let matches = true;

            if (estadoFiltro) {
              matches = matches && ciclo.estado === estadoFiltro;
            }

            if (periodoFiltro) {
              const estadoPeriodo = obtenerEstadoPeriodo(ciclo.periodo_inicio, ciclo.periodo_final);
              matches = matches && estadoPeriodo === periodoFiltro;
            }

            if (fechaInicio && ciclo.periodo_inicio) {
              matches = matches && new Date(ciclo.periodo_inicio) >= new Date(fechaInicio);
            }

            if (fechaFin && ciclo.periodo_final) {
              matches = matches && new Date(ciclo.periodo_final) <= new Date(fechaFin);
            }

            return matches;
          });

          mostrarEstadisticas(datosReporte);
          showNotification(`Reporte generado con ${datosReporte.length} ciclos`, 'info');
        });
      }

      // Botones de exportar
      const exportarPDFBtn = document.getElementById('exportarReportePDFBtn');
      if (exportarPDFBtn) {
        exportarPDFBtn.addEventListener('click', exportarReportePDF);
      }

      const exportarExcelBtn = document.getElementById('exportarReporteExcelBtn');
      if (exportarExcelBtn) {
        exportarExcelBtn.addEventListener('click', exportarReporteExcel);
      }

      // Calcular duración en tiempo real
      const inicioInput = document.getElementById('periodo_inicio');
      const finalInput = document.getElementById('periodo_final');
      if (inicioInput) {
        inicioInput.addEventListener('change', calcularDuracionEnTiempoReal);
      }
      if (finalInput) {
        finalInput.addEventListener('change', calcularDuracionEnTiempoReal);
      }

      // Form submit
      if (cicloForm) {
        cicloForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          
          const cicloId = document.getElementById('cicloId').value;
          const isEdit = !!cicloId;

          const data = {
            nombre: document.getElementById('nombre').value,
            descripcion: document.getElementById('descripcion').value,
            periodo_inicio: document.getElementById('periodo_inicio').value,
            periodo_final: document.getElementById('periodo_final').value,
            novedades: document.getElementById('novedades').value || null,
            usuario_id: document.getElementById('usuario_id').value || null
          };

          if (isEdit) {
            data.estado = document.getElementById('estado').value;
          }

          try {
            const url = isEdit ? `${API_URL}/${cicloId}` : API_URL;
            const method = isEdit ? 'PUT' : 'POST';
            
            const response = await fetch(url, {
              method: method,
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(data)
            });

            if (!response.ok) {
              const errorData = await response.json();
              throw new Error(errorData.error || 'Error en la operación');
            }

            showNotification(
              isEdit ? 'Ciclo actualizado exitosamente' : 'Ciclo creado exitosamente',
              'success'
            );
            
            cerrarModal(modalCiclo);
            cargarCiclos();
          } catch (error) {
            console.error('Error:', error);
            showNotification('Error: ' + error.message, 'error');
          }
        });
      }

      // Cerrar modales
      document.querySelectorAll('.modal__close').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const modal = e.target.closest('.modal');
          cerrarModal(modal);
        });
      });

      const cancelarBtn = document.getElementById('cancelarBtn');
      if (cancelarBtn) {
        cancelarBtn.addEventListener('click', () => {
          cerrarModal(modalCiclo);
        });
      }

      // Click fuera del modal
      window.addEventListener('click', (e) => {
        if (e.target.classList.contains('modal')) {
          cerrarModal(e.target);
        }
      });
    }

    // Inicialización
    async function init() {
      console.log('Initializing application...');
      
      setupTabs();
      setupEventListeners();
      
      await cargarUsuarios();
      await cargarCiclos();
      
      mostrarEstadisticas();
      
      console.log('Application initialized successfully');
    }

    // Ejecutar cuando el DOM esté listo
    document.addEventListener('DOMContentLoaded', init);
  </script>

  <style>
    /* [ESTILOS BASE IGUALES AL CÓDIGO ANTERIOR] */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.3rem 1.5rem;
      background-color: #67BC26;
      width: 100%;
      color: white;
      position: fixed;
      top: 0;
      z-index: 100;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .header__left-section {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .header__menu-item {
      font-size: 0.95rem;
      color: white;
      font-weight: 500;
    }

    .header__menu-separator {
      color: white;
      opacity: 0.8;
    }

    .header__right-section {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .header__search-bar {
      padding: 0.6rem 1rem;
      font-size: 0.9rem;
      border: 1px solid transparent;
      border-radius: 2rem;
      background-color: #2E7D32;
      color: white;
      width: 250px;
      transition: all 0.3s ease;
    }

    .header__search-bar::placeholder {
      color: rgba(255,255,255,0.7);
    }

    .header__search-bar:focus {
      outline: none;
      border-color: rgba(255,255,255,0.3);
      background-color: #67BC26;
    }

    .header__icon {
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      color: white;
      cursor: pointer;
      transition: all 0.3s ease;
      width: 2.5rem;
      height: 2.5rem;
      border-radius: 50%;
    }

    .header__icon:hover {
      color: #388E3C;
      background-color: white;
    }

    .content__table{
      margin:0;
    }

    main {
      margin-top: 80px;
      padding: 20px;
    }

    .full-main {
      margin-left: 2rem;
    }

    .content {
      max-width: 1400px;
      margin: 0;
    }

    /* Estilos específicos para ciclos de cultivo */
    .periodo-badge {
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
    }

    .periodo-activo {
      background-color: #d4edda;
      color: #155724;
    }

    .periodo-futuro {
      background-color: #fff3cd;
      color: #856404;
    }

    .periodo-pasado {
      background-color: #f8d7da;
      color: #721c24;
    }

    .form-value {
      font-size: 1.1rem;
      font-weight: bold;
      color: #28a745;
      padding: 8px 12px;
      background: #f8f9fa;
      border-radius: 4px;
      display: inline-block;
      border: 1px solid #e9ecef;
    }

    .filters-container {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
      padding: 15px;
      background-color: #f8f9fa;
      border-radius: 8px;
    }

    .filter-select {
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }

    .produccion__tabs {
      display: flex;
      gap: 5px;
      margin-bottom: 25px;
      border-bottom: 1px solid #ddd;
    }

    .produccion__tab {
      padding: 12px 24px;
      background: none;
      border: none;
      cursor: pointer;
      font-size: 16px;
      color: #666;
      transition: all 0.3s ease;
      border-bottom: 3px solid transparent;
    }

    .produccion__tab--active {
      color: #28a745;
      border-bottom-color: #28a745;
      font-weight: 600;
    }

    .produccion__section {
      display: none;
    }

    .produccion__section--active {
      display: block;
    }

    .reportes-container {
      display: grid;
      grid-template-columns: 300px 1fr;
      gap: 30px;
      margin-top: 20px;
    }

    .reporte-filters {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      height: fit-content;
    }

    .filter-group {
      margin-bottom: 15px;
    }

    .filter-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
    }

    .filter-group input,
    .filter-group select {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }

    .export-buttons {
      margin-top: 20px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .estadisticas-container {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin: 15px 0;
    }

    .stat-item {
      padding: 15px;
      background: #f8f9fa;
      border-radius: 8px;
      border-left: 4px solid #28a745;
    }

    .graficos-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .grafico-item {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      height: 400px;
    }

    .grafico-item h4 {
      text-align: center;
      margin-bottom: 15px;
      color: #333;
    }

    .grafico-item canvas {
      height: 300px !important;
    }

    .produccion__content {
      margin: 0;
    }

    .produccion__button {
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .produccion__button--primary {
      background-color: #28a745;
      color: white;
    }

    .produccion__button--primary:hover {
      background-color: #218838;
    }

    .produccion__button--secondary {
      background-color: #6c757d;
      color: white;
    }

    .produccion__button--secondary:hover {
      background-color: #545b62;
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }

    .modal__content {
      background: white;
      border-radius: 8px;
      padding: 25px;
      max-width: 800px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
    }

    .modal__close {
      position: absolute;
      top: 15px;
      right: 20px;
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #666;
    }

    .modal-form {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .form-group label {
      font-weight: 500;
      color: #333;
    }

    .required {
      color: #dc3545;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }

    .form-group textarea {
      resize: vertical;
      min-height: 80px;
    }

    .modal__actions {
      display: flex;
      gap: 15px;
      justify-content: flex-end;
      padding-top: 20px;
      border-top: 1px solid #eee;
    }

    .detalles-content {
      max-height: 400px;
      overflow-y: auto;
    }

    .detalle-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }

    .detalle-item {
      padding: 10px;
      background-color: #f8f9fa;
      border-radius: 4px;
    }

    .detalle-item.full-width {
      grid-column: 1 / -1;
    }

    @media (max-width: 768px) {
      .header__search-bar {
        width: 150px;
      }

      .form-row {
        grid-template-columns: 1fr;
      }

      .reportes-container {
        grid-template-columns: 1fr;
      }

      .detalle-grid {
        grid-template-columns: 1fr;
      }

      .graficos-container {
        grid-template-columns: 1fr;
      }
    }
  </style>
</body>
</html>
