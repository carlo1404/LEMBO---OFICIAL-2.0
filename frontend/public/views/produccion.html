<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Producciones Agrícolas</title>
    <link rel="stylesheet" href="/frontend/public/css/pages/produccion.css">
    <link rel="stylesheet" href="/frontend/public/css/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/frontend/JS/sidebar.js"></script>
    <script src="../../JS/produccionData.js" defer></script>
    <script src="../../JS/produccionForms.js" defer></script>
    <script src="../../JS/produccionUI.js" defer></script>
</head>

<body>
    <aside class="sidebar"></aside>
    <div class="produccion">
        <!-- Header -->
        <header class="produccion__header">
            <h1 class="produccion__title">Gestión de Producciones Agrícolas</h1>
            <div class="produccion__actions">
                <button class="produccion__button produccion__button--primary" id="crearProduccionBtn">
                    <i class="fas fa-plus"></i> Crear Producción
                </button>
            </div>
        </header>

        <!-- Tabs Navigation -->
        <nav class="produccion__tabs">
            <button class="produccion__tab produccion__tab--active" data-tab="listar">Listar Producciones</button>
            <button class="produccion__tab" data-tab="estado">Habilitar/Deshabilitar</button>
            <button class="produccion__tab" data-tab="reportes">Generar Reportes</button>
        </nav>

        <!-- Main Content -->
        <main class="produccion__content">
            <!-- Listar Producciones (Default View) -->
            <section class="produccion__section produccion__section--active" id="listar">
                <div class="produccion__filters">
                    <div class="produccion__filter-group">
                        <label for="filterNombre" class="produccion__label">Nombre:</label>
                        <input type="text" id="filterNombre" class="produccion__input">
                    </div>
                    <div class="produccion__filter-group">
                        <label for="filterCultivo" class="produccion__label">Cultivo:</label>
                        <select id="filterCultivo" class="produccion__select">
                            <option value="">Todos</option>
                            <!-- Cultivos se cargarán dinámicamente -->
                        </select>
                    </div>
                    <div class="produccion__filter-group">
                        <label for="filterEstado" class="produccion__label">Estado:</label>
                        <select id="filterEstado" class="produccion__select">
                            <option value="">Todos</option>
                            <option value="activo">Activo</option>
                            <option value="inactivo">Inactivo</option>
                        </select>
                    </div>
                    <button class="produccion__button produccion__button--secondary" id="aplicarFiltros">
                        <i class="fas fa-filter"></i> Aplicar Filtros
                    </button>
                    <button class="produccion__button produccion__button--secondary" id="limpiarFiltros">
                        <i class="fas fa-broom"></i> Limpiar
                    </button>
                </div>

                <div class="produccion__table-container">
                    <table class="produccion__table">
                        <thead>
                            <tr>
                                <th>ID Producción</th>
                                <th>Nombre</th>
                                <th>Cultivo</th>
                                <th>Ciclo</th>
                                <th>Fecha Inicio</th>
                                <th>Fecha Fin</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="produccionesTableBody">
                            <!-- Datos se cargarán dinámicamente -->
                        </tbody>
                    </table>
                </div>

                <div class="produccion__pagination">
                    <button class="produccion__pagination-button" id="prevPage"><i class="fas fa-chevron-left"></i>
                        Anterior</button>
                    <div class="produccion__pagination-numbers" id="paginationNumbers"></div>
                    <button class="produccion__pagination-button" id="nextPage">Siguiente <i
                            class="fas fa-chevron-right"></i></button>
                </div>
            </section>

            <!-- Habilitar/Deshabilitar Producción -->
            <section class="produccion__section" id="estado">
                <div class="produccion__status-container">
                    <h2 class="produccion__subtitle">Cambiar Estado de Producciones</h2>
                    <div class="produccion__status-actions">
                        <button class="produccion__button produccion__button--success" id="habilitarProducciones">
                            <i class="fas fa-check-circle"></i> Habilitar Seleccionadas
                        </button>
                        <button class="produccion__button produccion__button--danger" id="deshabilitarProducciones">
                            <i class="fas fa-times-circle"></i> Deshabilitar Seleccionadas
                        </button>
                    </div>
                    <div class="produccion__table-container">
                        <table class="produccion__table">
                            <thead>
                                <tr>
                                    <th><input type="checkbox" id="selectAllProducciones"></th>
                                    <th>ID Producción</th>
                                    <th>Nombre</th>
                                    <th>Cultivo</th>
                                    <th>Estado Actual</th>
                                </tr>
                            </thead>
                            <tbody id="estadoTableBody">
                                <!-- Datos se cargarán dinámicamente -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Generar Reportes -->
            <section class="produccion__section" id="reportes">
                <div class="produccion__reports-container">
                    <h2 class="produccion__subtitle">Generar Reportes de Producciones</h2>
                    <div class="produccion__report-filters">
                        <div class="produccion__filter-group">
                            <label for="reportFechaInicio" class="produccion__label">Fecha Inicio:</label>
                            <input type="text" id="reportFechaInicio" class="produccion__input produccion__input--date">
                        </div>
                        <div class="produccion__filter-group">
                            <label for="reportFechaFin" class="produccion__label">Fecha Fin:</label>
                            <input type="text" id="reportFechaFin" class="produccion__input produccion__input--date">
                        </div>
                        <div class="produccion__filter-group">
                            <label for="reportEstado" class="produccion__label">Estado:</label>
                            <select id="reportEstado" class="produccion__select">
                                <option value="">Todos</option>
                                <option value="activo">Activo</option>
                                <option value="inactivo">Inactivo</option>
                            </select>
                        </div>
                        <button class="produccion__button produccion__button--secondary" id="aplicarReportFilters">
                            <i class="fas fa-filter"></i> Aplicar Filtros
                        </button>
                    </div>

                    <div class="produccion__table-container">
                        <table class="produccion__table">
                            <thead>
                                <tr>
                                    <th><input type="checkbox" id="selectAllReports"></th>
                                    <th>ID Producción</th>
                                    <th>Nombre</th>
                                    <th>Cultivo</th>
                                    <th>Ciclo</th>
                                    <th>Fecha Inicio</th>
                                    <th>Fecha Fin</th>
                                    <th>Estado</th>
                                </tr>
                            </thead>
                            <tbody id="reportesTableBody">
                                <!-- Datos se cargarán dinámicamente -->
                            </tbody>
                        </table>
                    </div>

                    <div class="produccion__report-actions">
                        <div class="produccion__report-format">
                            <label class="produccion__label">Formato:</label>
                            <select id="reportFormat" class="produccion__select">
                                <option value="pdf">PDF</option>
                                <option value="excel">Excel</option>
                            </select>
                        </div>
                        <button class="produccion__button produccion__button--primary" id="generarReporte">
                            <i class="fas fa-file-export"></i> Generar Reporte
                        </button>
                    </div>
                </div>
            </section>
        </main>
    </div>
    <div class="stats-sidebar">
        <div class="chart-container">
            <h3 class="chart-title">Temperatura (°C)</h3>
            <canvas id="tempChart"></canvas>
        </div>
        
        <div class="chart-container">
            <h3 class="chart-title">Velocidad del Viento (km/h)</h3>
            <canvas id="windChart"></canvas>
        </div>
        
        <div class="chart-container">
            <h3 class="chart-title">Intensidad Lumínica (lux)</h3>
            <canvas id="lightChart"></canvas>
        </div>
    </div>
    <!-- Scripts externos -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="../../JS/statsSidebar.js"></script>

    <!-- Se asume que los archivos JS están en el mismo directorio; modifique las rutas si es necesario -->
    <script src="../../JS/produccionData.js"></script>
    <script src="../../JS/produccionUI.js"></script>
    <script src="../../JS/produccionForms.js"></script>

    <!-- Script adicional para manejar filtros (aplicar/limpiar) -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const aplicarFiltrosBtn = document.getElementById('aplicarFiltros');
            const limpiarFiltrosBtn = document.getElementById('limpiarFiltros');

            if (aplicarFiltrosBtn) {
                aplicarFiltrosBtn.addEventListener('click', () => {
                    // Reinicia a la primera página y actualiza la tabla (los eventos de cambio en los selects ya actualizan también)
                    currentPage = 1;
                    updateProduccionesTable();
                    updatePagination();
                });
            }

            if (limpiarFiltrosBtn) {
                limpiarFiltrosBtn.addEventListener('click', () => {
                    document.getElementById('filterNombre').value = '';
                    document.getElementById('filterCultivo').value = '';
                    document.getElementById('filterEstado').value = '';
                    currentPage = 1;
                    updateProduccionesTable();
                    updatePagination();
                });
            }
        });
    </script>
</body>

</html>